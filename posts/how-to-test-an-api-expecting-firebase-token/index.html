<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="How to test an API expecting Firebase token" /><meta property="og:locale" content="en" /><meta name="description" content="Let’s say you are developing a backend API and you are protecting it with firebase tokens. This saves lots of development time on the frontend (mobile or web) just because Firebase Auth SDK does all the heavy lifting for token generation, refresh, etc, as well as on the backend for the exact same reason. But when you want to test this API with Postman or any other REST client you may face a problem, how to get the same token as the client receives from the Firebase SDK?" /><meta property="og:description" content="Let’s say you are developing a backend API and you are protecting it with firebase tokens. This saves lots of development time on the frontend (mobile or web) just because Firebase Auth SDK does all the heavy lifting for token generation, refresh, etc, as well as on the backend for the exact same reason. But when you want to test this API with Postman or any other REST client you may face a problem, how to get the same token as the client receives from the Firebase SDK?" /><link rel="canonical" href="https://antonkrasov.com/posts/how-to-test-an-api-expecting-firebase-token/" /><meta property="og:url" content="https://antonkrasov.com/posts/how-to-test-an-api-expecting-firebase-token/" /><meta property="og:site_name" content="Anton Krasov" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-07T19:50:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How to test an API expecting Firebase token" /><meta name="twitter:site" content="@OxKrasov" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-05-07T19:50:00-07:00","datePublished":"2022-05-07T19:50:00-07:00","description":"Let’s say you are developing a backend API and you are protecting it with firebase tokens. This saves lots of development time on the frontend (mobile or web) just because Firebase Auth SDK does all the heavy lifting for token generation, refresh, etc, as well as on the backend for the exact same reason. But when you want to test this API with Postman or any other REST client you may face a problem, how to get the same token as the client receives from the Firebase SDK?","headline":"How to test an API expecting Firebase token","mainEntityOfPage":{"@type":"WebPage","@id":"https://antonkrasov.com/posts/how-to-test-an-api-expecting-firebase-token/"},"url":"https://antonkrasov.com/posts/how-to-test-an-api-expecting-firebase-token/"}</script><title>How to test an API expecting Firebase token | Anton Krasov</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Anton Krasov"><meta name="application-name" content="Anton Krasov"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/photo.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Anton Krasov</a></div><div class="site-subtitle font-italic">Personal blog about building software, life, habits, and philosophy</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/antonkrasov" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/OxKrasov" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['anton.krasov','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>How to test an API expecting Firebase token</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>How to test an API expecting Firebase token</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/OxKrasov">Anton Krasov</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1651978200" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-05-07 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="887 words"> <em>4 min</em> read</span></div></div></div><div class="post-content"><p>Let’s say you are developing a backend API and you are protecting it with firebase tokens. This saves lots of development time on the frontend (mobile or web) just because Firebase Auth SDK does all the heavy lifting for token generation, refresh, etc, as well as on the backend for the exact same reason. But when you want to test this API with Postman or any other REST client you may face a problem, how to get the same token as the client receives from the Firebase SDK?</p><p>One of the ways to do it is to launch a client app and grab a token from there. Personally, I wasted lots of time doing this.</p><h2 id="better-solution"><span class="mr-2">Better Solution</span><a href="#better-solution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>There is a way better option for doing it, and I was surprised by how easy it is. All we need to do is to use Firebase Auth REST API (<a href="https://firebase.google.com/docs/reference/rest/auth">https://firebase.google.com/docs/reference/rest/auth</a>). It provides simple API calls we can use to manage our Firebase users as well as tokens.</p><h2 id="example"><span class="mr-2">Example</span><a href="#example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Let’s see by example how we can do it, I created a sample firebase project and deployed a simple cloud function:</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">firebase-functions</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">serviceAccount</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./service-account.json</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">initializeApp</span><span class="p">,</span> <span class="nx">cert</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin/app</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">getAuth</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin/auth</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">initializeApp</span><span class="p">({</span>
    <span class="na">credential</span><span class="p">:</span> <span class="nx">cert</span><span class="p">(</span><span class="nx">serviceAccount</span><span class="p">)</span>
<span class="p">})</span>
<span class="kd">const</span> <span class="nx">auth</span> <span class="o">=</span> <span class="nx">getAuth</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">protectedEndpoint</span> <span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nx">onRequest</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">xApiToken</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">x-api-token</span><span class="dl">'</span><span class="p">]</span>
        <span class="kd">const</span> <span class="nx">decodedToken</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">auth</span><span class="p">.</span><span class="nx">verifyIdToken</span><span class="p">(</span><span class="nx">xApiToken</span><span class="p">)</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">decodedToken</span> <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
            <span class="na">error</span><span class="p">:</span> <span class="dl">"</span><span class="s2">'x-api-token' header is required!</span><span class="dl">"</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></table></code></div></div><p>Let’s try to call it via cURL:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>➜  ~ curl https://us-central1-givemefirebasetoken-sample.cloudfunctions.net/protectedEndpoint
<span class="o">{</span><span class="s2">"error"</span>:<span class="s2">"'x-api-token' header is required!"</span><span class="o">}</span>%
</pre></table></code></div></div><p>As expected we got our error, because <code class="language-plaintext highlighter-rouge">auth.verifyIdToken()</code> failed.</p><p>Now let’s try to get the token via Rest API. The first thing we will need is an API_KEY for our Firebase project. The easiest way to get it is to create a Web app in your firebase console. Next, you’ll see your API_KEY in it. Here is an example from my sample project:</p><p><img data-src="/assets/img/2022-05-08-how-to-test-an-api-expecting-firebase-token/Screen_Shot_2022-05-07_at_8.15.32_PM.png" alt="Screen Shot 2022-05-07 at 8.15.32 PM.png" data-proofer-ignore></p><p>After we have our <code class="language-plaintext highlighter-rouge">apiKey</code> we can start making calls to the firebase, link to the detailed API reference: <a href="https://firebase.google.com/docs/reference/rest/auth">https://firebase.google.com/docs/reference/rest/auth</a></p><p>Personally I use 3 methods:</p><ul><li>Sign up with email / password (<a href="https://firebase.google.com/docs/reference/rest/auth#section-create-email-password">https://firebase.google.com/docs/reference/rest/auth#section-create-email-password</a>)<li>Sign in with email / password (<a href="https://firebase.google.com/docs/reference/rest/auth#section-sign-in-email-password">https://firebase.google.com/docs/reference/rest/auth#section-sign-in-email-password</a>)<li>Delete account (<a href="https://firebase.google.com/docs/reference/rest/auth#section-delete-account">https://firebase.google.com/docs/reference/rest/auth#section-delete-account</a>)</ul><p><code class="language-plaintext highlighter-rouge">Delete</code> is useful if we want to create a new user each time, we can use it in our autotests. So our flow would be like this:</p><ol><li>Sign Up with email/password.<li>Run API tests.<li>Delete user.</ol><p>Ok, let’s create a new user with API request:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>curl <span class="nt">--location</span> <span class="nt">--request</span> POST <span class="s1">'https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=AIzaSyAHV1eUu8EqCSUeycofXqfL******'</span> <span class="se">\</span>
<span class="nt">--header</span> <span class="s1">'Content-Type: application/json'</span> <span class="se">\</span>
<span class="nt">--data-raw</span> <span class="s1">'{
    "email": "anton.krasov@gmail.com",
    "password": "******",
    "returnSecureToken": true
}'</span>
</pre></table></code></div></div><p>Our response should look like this:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">{</span>
  <span class="s2">"kind"</span>: <span class="s2">"identitytoolkit#SignupNewUserResponse"</span>,
  <span class="s2">"idToken"</span>: <span class="s2">"eyJhbGciOiJSUzI1NiIsImtpZ....gkULJig1ypXaA"</span>,
  <span class="s2">"email"</span>: <span class="s2">"anton.krasov@gmail.com"</span>,
  <span class="s2">"refreshToken"</span>: <span class="s2">"AIwUaOkfNuMg8Kdatx-Hy8_5Ti0sm....-dKiN0CGkDfX1ch5f69g5Y5K"</span>,
  <span class="s2">"expiresIn"</span>: <span class="s2">"3600"</span>,
  <span class="s2">"localId"</span>: <span class="s2">"aoiC7bM0v....ueGMRegf1k2"</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">idToken</code> is exactly the same token we will receive from our Firebase Auth SDK.</p><p><code class="language-plaintext highlighter-rouge">localId</code> is our new user Id.</p><p>Just remember that you need to have <code class="language-plaintext highlighter-rouge">Email/Password</code> auth provider enabled in your <code class="language-plaintext highlighter-rouge">Authentication</code> settings:</p><p><img data-src="/assets/img/2022-05-08-how-to-test-an-api-expecting-firebase-token/Screen_Shot_2022-05-07_at_9.33.33_PM.png" alt="Screen Shot 2022-05-07 at 9.33.33 PM.png" data-proofer-ignore></p><p>Now, we have an <code class="language-plaintext highlighter-rouge">idToken</code> let’s try to execute our sample call again:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>curl <span class="nt">--location</span> <span class="nt">--request</span> GET <span class="s1">'https://us-central1-givemefirebasetoken-sample.cloudfunctions.net/protectedEndpoint'</span> <span class="se">\</span>
<span class="nt">--header</span> <span class="s1">'x-api-token: eyJhbGciOiJSUzI1NiIsImtpZ....09HlrF49MRWo9qq0_c6UiMHdBZUavNXyuFyjC85dpSxJrNtJSwH5OQa22dIwdbNmfMqz6ljAivIkjw5aX2GrF5ViFCdp4Tew5iw'</span>
</pre></table></code></div></div><p>and we got our <code class="language-plaintext highlighter-rouge">decodedToken</code> in response:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">{</span><span class="s2">"decodedToken"</span>:<span class="o">{</span><span class="s2">"iss"</span>:<span class="s2">"https://securetoken.google.com/givemefirebasetoken-sample"</span>,<span class="s2">"aud"</span>:<span class="s2">"givemefirebasetoken-sample"</span>,<span class="s2">"auth_time"</span>:1651977397,<span class="s2">"user_id"</span>:<span class="s2">"aoiC7bM0vFQTMPj24ueGMRegf1k2"</span>,<span class="s2">"sub"</span>:<span class="s2">"aoiC7bM0vFQTMPj24ueGMRegf1k2"</span>,<span class="s2">"iat"</span>:1651977397,<span class="s2">"exp"</span>:1651980997,<span class="s2">"email"</span>:<span class="s2">"anton.krasov@gmail.com"</span>,<span class="s2">"email_verified"</span>:false,<span class="s2">"firebase"</span>:<span class="o">{</span><span class="s2">"identities"</span>:<span class="o">{</span><span class="s2">"email"</span>:[<span class="s2">"anton.krasov@gmail.com"</span><span class="o">]}</span>,<span class="s2">"sign_in_provider"</span>:<span class="s2">"password"</span><span class="o">}</span>,<span class="s2">"uid"</span>:<span class="s2">"aoiC7bM0vFQTMPj24ueGMRegf1k2"</span><span class="o">}}</span>
</pre></table></code></div></div><h2 id="leverage-postman-environments"><span class="mr-2">Leverage Postman Environments</span><a href="#leverage-postman-environments" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Now we know the API calls we need to execute to get the user’s info, let’s leverage postman variables and environments (<a href="https://learning.postman.com/docs/sending-requests/variables/">https://learning.postman.com/docs/sending-requests/variables/</a>) to store the token and use it with our own backend API calls.</p><p>First thing, let’s create env and setup variables we need:</p><p><img data-src="/assets/img/2022-05-08-how-to-test-an-api-expecting-firebase-token/Screen_Shot_2022-05-07_at_9.40.33_PM.png" alt="Screen Shot 2022-05-07 at 9.40.33 PM.png" data-proofer-ignore></p><p>Variables are pretty self explanatory ;)</p><p>Now, let’s create our <code class="language-plaintext highlighter-rouge">accounts:signUp</code> request, and execute it:</p><p><img data-src="/assets/img/2022-05-08-how-to-test-an-api-expecting-firebase-token/Screen_Shot_2022-05-07_at_9.44.21_PM.png" alt="Screen Shot 2022-05-07 at 9.44.21 PM.png" data-proofer-ignore></p><p>Now, once we receive our token, let’s save it in our environment using <code class="language-plaintext highlighter-rouge">Tests</code> tab (<a href="https://learning.postman.com/docs/writing-scripts/test-scripts/">https://learning.postman.com/docs/writing-scripts/test-scripts/</a>):</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">jsonData</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">responseBody</span><span class="p">);</span>
<span class="nx">pm</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">jsonData</span><span class="p">.</span><span class="nx">idToken</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">be</span><span class="p">.</span><span class="nx">a</span><span class="p">(</span><span class="dl">'</span><span class="s1">string</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">postman</span><span class="p">.</span><span class="nx">setEnvironmentVariable</span><span class="p">(</span><span class="dl">"</span><span class="s2">firebaseIdToken</span><span class="dl">"</span><span class="p">,</span> <span class="nx">jsonData</span><span class="p">.</span><span class="nx">idToken</span><span class="p">);</span>
</pre></table></code></div></div><p>On the second line, we also validate that we have <code class="language-plaintext highlighter-rouge">idToken</code> and it’s a string. This is required to prevent setting up the wrong <code class="language-plaintext highlighter-rouge">firebaseIdToken</code> env var if our request failed. Let’s say you called <code class="language-plaintext highlighter-rouge">accounts:signUp</code> request twice and got an error from the firebase saying that the user already exists.</p><p>Now, after the execution we’ll have our token in our env, and we can use it in our own API calls.</p><p><img data-src="/assets/img/2022-05-08-how-to-test-an-api-expecting-firebase-token/Screen_Shot_2022-05-07_at_9.48.30_PM.png" alt="Screen Shot 2022-05-07 at 9.48.30 PM.png" data-proofer-ignore></p><h2 id="automatic-token-retrieval"><span class="mr-2">Automatic token retrieval</span><a href="#automatic-token-retrieval" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Postman has a nice feature called <code class="language-plaintext highlighter-rouge">pre-request scripts:</code> <a href="https://learning.postman.com/docs/writing-scripts/pre-request-scripts/">https://learning.postman.com/docs/writing-scripts/pre-request-scripts/</a></p><p>We can use it to automate retrieving of our token and setting of our env, and the best thing about it is that we can create a pre-request script <strong>for the whole collection</strong>! This means that we won’t need to call any of the firebase requests manually.</p><p>Here is an example script:</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">firebaseApiKey</span> <span class="o">=</span> <span class="nx">pm</span><span class="p">.</span><span class="nx">environment</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">firebaseApiKey</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">firebaseTestUserEmail</span> <span class="o">=</span> <span class="nx">pm</span><span class="p">.</span><span class="nx">environment</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">firebaseTestUserEmail</span><span class="dl">"</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">firebaseTestUserPassword</span> <span class="o">=</span> <span class="nx">pm</span><span class="p">.</span><span class="nx">environment</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">firebaseTestUserPassword</span><span class="dl">"</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">url</span><span class="p">:</span> <span class="s2">`https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=</span><span class="p">${</span><span class="nx">firebaseApiKey</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">header</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">'</span><span class="s1">Accept</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">*/*</span><span class="dl">'</span><span class="p">,</span>
        <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">body</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">raw</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">raw</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
            <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">:</span> <span class="nx">firebaseTestUserEmail</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">:</span> <span class="nx">firebaseTestUserPassword</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">returnSecureToken</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nx">pm</span><span class="p">.</span><span class="nx">sendRequest</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">respData</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>

    <span class="nx">pm</span><span class="p">.</span><span class="nx">environment</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">firebaseIdToken</span><span class="dl">"</span><span class="p">,</span> <span class="nx">respData</span><span class="p">.</span><span class="nx">idToken</span><span class="p">);</span>
    <span class="nx">pm</span><span class="p">.</span><span class="nx">environment</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">firebaseUID</span><span class="dl">"</span><span class="p">,</span> <span class="nx">respData</span><span class="p">.</span><span class="nx">localId</span><span class="p">);</span>
<span class="p">});</span>
</pre></table></code></div></div><hr /><p>Thank you, feel free to contact me via email: anton.krasov@gmail.com if you have any questions ;)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tech/'>Tech</a>, <a href='/categories/tutorial/'>Tutorial</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/firebase/" class="post-tag no-text-decoration" >firebase</a> <a href="/tags/postman/" class="post-tag no-text-decoration" >postman</a> <a href="/tags/backend/" class="post-tag no-text-decoration" >backend</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How to test an API expecting Firebase token - Anton Krasov&amp;url=https://antonkrasov.com/posts/how-to-test-an-api-expecting-firebase-token/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How to test an API expecting Firebase token - Anton Krasov&amp;u=https://antonkrasov.com/posts/how-to-test-an-api-expecting-firebase-token/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://antonkrasov.com/posts/how-to-test-an-api-expecting-firebase-token/&amp;text=How to test an API expecting Firebase token - Anton Krasov" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/firebase/">firebase</a> <a class="post-tag" href="/tags/postman/">postman</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></span> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/OxKrasov">Anton Krasov</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/firebase/">firebase</a> <a class="post-tag" href="/tags/postman/">postman</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
